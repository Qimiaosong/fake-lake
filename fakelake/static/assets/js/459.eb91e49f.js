"use strict";(self["webpackChunkdata_lake_analytics"]=self["webpackChunkdata_lake_analytics"]||[]).push([[459],{459:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});var l=a(6252),s=a(2262),o=a(3577),n=a(9963),c=a(3907),i=a(2201),u=a(6583),r=a(219);const p=e=>((0,l.dD)("data-v-fa8caf08"),e=e(),(0,l.Cn)(),e),d={class:"main"},m=p((()=>(0,l._)("p",{class:"component-heading"},"调度历史",-1))),_={key:0},g={class:"collapse-item-title-slot"},w={class:"main-info"},y={class:"name"},v={class:"status"},k={class:"time"},f={style:{color:"#fab6b6"}},b={key:0,class:"self-content"},h=p((()=>(0,l._)("p",{class:"resultJob-title"},"执行记录",-1))),S={class:"resultJob-item-wrap"},j={class:"resultJob-item-content"},H={key:0,class:"log"};var U=(0,l.aZ)({__name:"SchedulingDetails",setup(e){const t=(0,c.oR)(),a=(0,i.yj)(),p=(0,i.tv)(),U=(0,s.iH)(!1),W=(0,s.iH)(null),z=(0,s.iH)(a.query?.type||"dataLake"),C=(0,l.Fl)((()=>t.state[z.value])),D=(0,l.Fl)((()=>t.state[z.value].historyJobs||[])),J=e=>{t.dispatch(`${z.value}/getHistoryJobs`,{id:e})},P=e=>{t.dispatch(`${z.value}/retryHistoryJob`,{id:e}).then((e=>{10031==e.data.code?(J(a.query?.task),t.commit("POP_MESSAGE",{message:e.data.message,type:"success"},{root:!0})):t.commit("POP_MESSAGE",{message:e.data.message,type:"error"},{root:!0})})).catch((e=>{console.log(e)}))};(0,l.wF)((()=>{J(a.query?.task)}));const R=e=>{t.state[z.value].jobsPageInfo.currentPage=e,J(a.query?.task)},q=(e,a)=>{U.value=!0,W.value=null,t.dispatch(`${z.value}/getHistoryJobLog`,{job_id:e.id,app_id:a.app_id}).then((e=>{W.value=e.data})).catch((e=>{console.log("err",e)}))},x=()=>{p.go(-1)};return(e,t)=>{const a=(0,l.up)("info-filled"),c=(0,l.up)("el-icon"),i=(0,l.up)("SvgIcon"),p=(0,l.up)("el-tooltip"),z=(0,l.up)("el-empty"),J=(0,l.up)("el-collapse-item"),E=(0,l.up)("el-collapse"),I=(0,l.up)("el-drawer");return(0,l.wg)(),(0,l.iD)("div",d,[(0,l._)("div",{class:"guide-action"},[m,(0,l._)("p",{class:"back",onClick:x},"返回")]),(0,s.SU)(D)&&(0,s.SU)(D).length>0?((0,l.wg)(),(0,l.iD)("div",_,[(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,s.SU)(D),((e,t)=>((0,l.wg)(),(0,l.j4)(J,{key:t,style:(0,o.j5)({"--color":(0,s.SU)(u.HR)(e?.status)?.color}),name:t},{title:(0,l.w5)((()=>[(0,l._)("div",g,[(0,l._)("div",w,[(0,l._)("p",y,(0,o.zw)(e?.job_name),1),(0,l._)("p",v,[(0,l.Wm)(c,{class:"header-icon"},{default:(0,l.w5)((()=>[(0,l.Wm)(a)])),_:1}),(0,l._)("span",null," "+(0,o.zw)((0,s.SU)(u.HR)(e.status)?.text),1)]),(0,l._)("p",k,(0,o.zw)((0,s.SU)(u.Wt)(e?.created_at)),1)]),(0,l._)("span",f,"运行"+(0,o.zw)(e.retry_count+1)+"次",1),(0,l.Wm)(p,{effect:"dark",content:"重新执行",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{width:"30px",height:"30px",onClick:(0,n.iM)((t=>P(e.id)),["stop"]),name:"start",stroke:"var(--el-color-primary)"},null,8,["onClick"])])),_:2},1024)])])),default:(0,l.w5)((()=>[e.job_results&&e.job_results.length?((0,l.wg)(),(0,l.iD)("div",b,[h,(0,l._)("div",S,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.job_results,((t,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a,class:"resultJob-item",style:(0,o.j5)({"--color":(0,s.SU)(u.HR)(t?.app_state)?.color})},[(0,l._)("div",j,[(0,l._)("span",null,(0,o.zw)(`第${t?.order+1}次执行`),1),(0,l._)("span",null,(0,o.zw)(t?.app_name),1),(0,l._)("span",null,(0,o.zw)((0,s.SU)(u.HR)(t?.app_state)?.text),1),(0,l.Wm)(p,{effect:"dark",content:"日志",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{onClick:(0,n.iM)((a=>q(e,t)),["stop"]),name:"log",stroke:"black"},null,8,["onClick"])])),_:2},1024)])],4)))),128))])])):((0,l.wg)(),(0,l.j4)(z,{key:1,description:"空"}))])),_:2},1032,["style","name"])))),128))])),_:1}),(0,l.Wm)(r.Z,{module:(0,s.SU)(C).jobsPageInfo,onChangePage:R},null,8,["module"])])):((0,l.wg)(),(0,l.j4)(z,{key:1,class:"self-el-empty",description:"还没有调度历史"})),(0,l.Wm)(I,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),title:"日志",direction:"rtl",size:"60%"},{default:(0,l.w5)((()=>[W.value?((0,l.wg)(),(0,l.iD)("pre",H,(0,o.zw)(W.value),1)):((0,l.wg)(),(0,l.j4)(z,{key:1,description:"日志为空"}))])),_:1},8,["modelValue"])])}}}),W=a(3744);const z=(0,W.Z)(U,[["__scopeId","data-v-fa8caf08"]]);var C=z}}]);
//# sourceMappingURL=459.eb91e49f.js.map