"use strict";(self["webpackChunkdata_lake_analytics"]=self["webpackChunkdata_lake_analytics"]||[]).push([[402],{3402:function(e,a,l){l.r(a),l.d(a,{default:function(){return k}});l(7658);var t=l(6252),r=l(3577),o=l(2262),s=l(9963),u=l(3907),n=l(9737),d=l(6583),i=l(3625),c=l(219),p=l(2201);const m={class:"main"},w={class:"user-info-section"},f={class:"create-btn"};var g=(0,t.aZ)({__name:"index",setup(e){const a=(0,u.oR)(),l=(0,p.tv)(),g=(0,o.iH)(!1),_=(0,o.iH)(!1),h={name:"",password:"",workspaces:[{id:"",roles:[]}]},k=(0,o.iH)(),v=((0,o.qj)({name:[{required:!0,trigger:"blur",message:"不能为空"}],password:[{required:!0,trigger:"blur",message:"不能为空"}]}),(0,o.iH)(JSON.parse(JSON.stringify(h)))),y=e=>{g.value=e},W=()=>{a.dispatch("users/getUsers",{workspace_id:x.value?.id})},b=(0,t.Fl)((()=>a.state.users.users));(0,t.wF)((()=>{W()}));const U=async()=>{await a.dispatch("role/getRoles",{all:!0})},S=(0,t.Fl)((()=>a.state.role.allRoleList||[])),C=e=>{e&&U()},V=(e,a,l)=>{let t=[];return l?.forEach((e=>{t.push(e.name)})),t.join(",")},E=async()=>{await a.dispatch("rightsManagement/getWorkspaceList",{all:!0})},P=(0,t.Fl)((()=>a.state.rightsManagement.allWorkspaceList||[])),x=(0,t.Fl)((()=>a.state.rightsManagement.curWorkspace)),M=e=>{e&&E()},A=()=>{y(!0),_.value=!1,v.value=JSON.parse(JSON.stringify(h))},O=()=>{let e=[k.value];(0,d.R2)(e).then((async()=>{const e=v.value?.workspaces.every((e=>void 0!==e.id&&Array.isArray(e.roles)&&e.roles.length>0));if(e)try{const e=await a.dispatch("users/createUser",{workspace_id:x.value?.id,is_super:0==D.value,curUser:v.value});if(10035===e?.data?.code)y(!1),n.T.confirm("您可创建的用户数量已达到上线，如果需要更多资源，请点击 去升级 前往关于页获取License!","提示",{confirmButtonText:"去升级",cancelButtonText:"暂时不用",type:"warning"}).then((()=>{l.push("/home/about")})).catch((()=>{}));else{if(10002===e?.data?.code)return;y(!1)}}catch(t){console.error(t)}else a.commit("POP_MESSAGE",{message:"工作空间或者角色不能为空",type:"error"})})).catch((e=>{a.commit("POP_MESSAGE",{message:"请检查表单填写",type:"error"})}))},j=()=>{v.value?.workspaces.push({id:null,roles:[]})},F=e=>{v.value?.workspaces.splice(e.$index,1)},H=async({row:e})=>{await U(),await E(),y(!0),_.value=!0,a.dispatch("users/getUserDetails",{id:e.id}).then((e=>{1e4==e.data.code&&(v.value=e.data.data,v.value["workspaces"]&&v.value["workspaces"].length?v.value["workspaces"].forEach((e=>{T(null,null,e?.id)&&P.value&&P.value?.length||(e.id=null),e.roles&&e.roles?.length&&e.roles.forEach(((a,l)=>{G(a)&&S.value&&S.value.length||(e.roles[l]=null)}))})):v.value["workspaces"]=[{id:"",roles:[]}])})).catch((e=>{a.commit("POP_MESSAGE",{message:e,type:"error"})}))},T=(e,a,l)=>{let t=P.value?.find((e=>e.id==l));return t?.name||""},G=e=>{let a=S.value?.find((a=>a.id==e));return a?.name||""},I=()=>{let e=[k.value];(0,d.R2)(e).then((()=>{const e=v.value?.workspaces.every((e=>void 0!==e.id&&Array.isArray(e.roles)&&e.roles.length>0));e?a.dispatch("users/updateUser",{workspace_id:x.value?.id,is_super:0==D.value,curUser:v.value}).then((()=>{y(!1)})):a.commit("POP_MESSAGE",{message:"工作空间或者角色不能为空",type:"error"})})).catch((e=>{a.commit("POP_MESSAGE",{message:"请检查表单填写",type:"error"})}))},N=({row:e})=>{n.T.confirm("确定删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.dispatch("users/deleteUser",{id:e.id})})).catch((e=>{console.log(e)}))},z=(0,t.Fl)((()=>localStorage.getItem("userName")||"")),D=(0,t.Fl)((()=>a.state.rightsManagement.curWorkspace?.role_type)),R=()=>{y(!1)},B=()=>{l.push({path:"/home/role"})},J=e=>{a.commit("users/SET_PAGE_INFO",{currentPage:e}),W()};return(e,l)=>{const u=(0,t.up)("el-col"),n=(0,t.up)("el-row"),p=(0,t.up)("el-button"),h=(0,t.up)("el-table-column"),k=(0,t.up)("el-table"),W=(0,t.up)("SvgIcon"),U=(0,t.up)("el-tooltip"),E=(0,t.up)("el-input"),T=(0,t.up)("el-form-item"),G=(0,t.up)("Plus"),D=(0,t.up)("el-icon"),L=(0,t.up)("el-option"),Z=(0,t.up)("el-select"),q=(0,t.up)("Delete"),K=(0,t.up)("el-form"),Y=(0,t.Q2)("permission");return(0,t.wg)(),(0,t.iD)("div",m,[(0,t._)("div",w,[(0,t.Wm)(n,{style:{"margin-bottom":"10px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{span:12},{default:(0,t.w5)((()=>[(0,t.Uk)("我的账户名："+(0,r.zw)((0,o.SU)(z)),1)])),_:1}),(0,t.Wm)(u,{span:12},{default:(0,t.w5)((()=>[(0,t.Uk)("我的角色："+(0,r.zw)(V(null,null,(0,o.SU)(a).state.rightsManagement.curWorkspace?.roles)),1)])),_:1})])),_:1}),(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{span:12},{default:(0,t.w5)((()=>[(0,t.Uk)("当前工作空间："+(0,r.zw)((0,o.SU)(x)?.name||""),1)])),_:1})])),_:1})]),(0,t._)("div",f,[(0,t.wy)(((0,t.wg)(),(0,t.j4)(p,{type:"primary",onClick:A},{default:(0,t.w5)((()=>[(0,t.Uk)("添加用户")])),_:1})),[[Y,"create"]]),(0,t.Wm)(p,{type:"primary",onClick:B,plain:""},{default:(0,t.w5)((()=>[(0,t.Uk)("自定义角色")])),_:1})]),(0,t.Wm)(k,{data:(0,o.SU)(b),"default-sort":{prop:"updated_at",order:"descending"},style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{prop:"name",label:"用户名"}),(0,t.Wm)(h,{prop:"workspace",label:"工作空间"},{default:(0,t.w5)((e=>[(0,t.Wm)(k,{data:e.row.workspaces,class:"table-head-color",border:""},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{prop:"name",label:"工作空间"}),(0,t.Wm)(h,{prop:"roles",label:"角色",formatter:V})])),_:2},1032,["data"])])),_:1}),(0,t.Wm)(h,{prop:"updated_at",label:"更新日期",formatter:(0,o.SU)(d.lI)},null,8,["formatter"]),(0,t.Wm)(h,{prop:"operation",label:"操作"},{default:(0,t.w5)((e=>[(0,t.Wm)(U,{effect:"dark",content:"编辑",placement:"top"},{default:(0,t.w5)((()=>[(0,t.wy)(((0,t.wg)(),(0,t.j4)(p,{size:"small",circle:"",onClick:(0,s.iM)((a=>H(e)),["stop"]),class:"icon-button",disabled:e.row.name===(0,o.SU)(z)},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{name:"edit",stroke:"var(--el-color-primary)"})])),_:2},1032,["onClick","disabled"])),[[Y,"update"]])])),_:2},1024),(0,t.Wm)(U,{effect:"dark",content:"删除",placement:"top"},{default:(0,t.w5)((()=>[(0,t.wy)(((0,t.wg)(),(0,t.j4)(p,{size:"small",circle:"",onClick:(0,s.iM)((a=>N(e)),["stop"]),class:"icon-button",disabled:e.row.name===(0,o.SU)(z)},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{name:"delete",stroke:"#f56c6c"})])),_:2},1032,["onClick","disabled"])),[[Y,"delete"]])])),_:2},1024)])),_:1})])),_:1},8,["data"]),(0,t.Wm)(i.Z,{show:g.value,onHandleShow:l[2]||(l[2]=e=>y(!1))},{popup:(0,t.w5)((()=>[(0,t.Wm)(K,{model:v.value,"label-width":"200px"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{label:"账户名"},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{modelValue:v.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value.name=e),disabled:_.value},null,8,["modelValue","disabled"])])),_:1}),(0,t.Wm)(T,{label:"密码"},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{modelValue:v.value.password,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value.password=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(T,{label:"权限"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{onClick:j,type:"primary",circle:"",style:{"margin-bottom":"10px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(D,null,{default:(0,t.w5)((()=>[(0,t.Wm)(G)])),_:1})])),_:1}),(0,t.Wm)(p,{onClick:B,type:"primary",plain:"",style:{"margin-left":"10px"}},{default:(0,t.w5)((()=>[(0,t.Uk)("自定义角色")])),_:1}),(0,t.Wm)(k,{data:v.value.workspaces,class:"table-head-color",style:{"max-height":"350px",overflow:"auto"}},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{prop:"name",label:"工作空间"},{default:(0,t.w5)((e=>[(0,t.Wm)(Z,{modelValue:e.row.id,"onUpdate:modelValue":a=>e.row.id=a,onVisibleChange:M},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,o.SU)(P),((e,a)=>((0,t.wg)(),(0,t.j4)(L,{key:a,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(h,{prop:"roles",label:"角色",formatter:V},{default:(0,t.w5)((e=>[(0,t.Wm)(Z,{modelValue:e.row.roles,"onUpdate:modelValue":a=>e.row.roles=a,onVisibleChange:C,multiple:"",style:{"margin-right":"10px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,o.SU)(S),((e,a)=>((0,t.wg)(),(0,t.j4)(L,{key:a,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(p,{onClick:a=>F(e),type:"danger",circle:""},{default:(0,t.w5)((()=>[(0,t.Wm)(D,null,{default:(0,t.w5)((()=>[(0,t.Wm)(q)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),(0,t.Wm)(T,null,{default:(0,t.w5)((()=>[_.value?((0,t.wg)(),(0,t.j4)(p,{key:1,type:"primary",onClick:I},{default:(0,t.w5)((()=>[(0,t.Uk)("更新")])),_:1})):((0,t.wg)(),(0,t.j4)(p,{key:0,type:"primary",onClick:O},{default:(0,t.w5)((()=>[(0,t.Uk)("创建")])),_:1})),(0,t.Wm)(p,{onClick:R},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["show"]),(0,t.Wm)(c.Z,{module:(0,o.SU)(a).state.users.pageInfo,onChangePage:J},null,8,["module"])])}}}),_=l(3744);const h=(0,_.Z)(g,[["__scopeId","data-v-020e4e3a"]]);var k=h}}]);
//# sourceMappingURL=402.c0b90010.js.map