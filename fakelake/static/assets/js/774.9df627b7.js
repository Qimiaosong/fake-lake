"use strict";(self["webpackChunkdata_lake_analytics"]=self["webpackChunkdata_lake_analytics"]||[]).push([[774],{2774:function(e,a,t){t.r(a),t.d(a,{default:function(){return k}});t(7658);var l=t(6252),o=t(2262),r=t(9963),n=t(3907),d=t(9737),i=t(6583),c=t(219),s=t(310);const u={class:"create-btn"},p={key:0,class:"table-cell-btn-box"};var m=(0,l.aZ)({__name:"role",setup(e){const a=(0,n.oR)(),t=(0,o.iH)(!1),m={name:"",role_type:3,data_permission:{dataSource:["create","update","delete"],dataLake:["create","read","delete"],dataModeling:["create","read","update"],dataAnalyze:["read","update","delete"]}},w=(0,o.iH)(JSON.parse(JSON.stringify(m))),f=()=>{a.dispatch("role/getRoles")},k=(0,l.Fl)((()=>a.state.role.roleList));(0,l.wF)((()=>{f()}));const _=()=>{t.value=!0,w.value=JSON.parse(JSON.stringify(m)),k.value?.unshift(w.value),w.value.create=!0,w.value.edit=!0},g=()=>{w.value?.name?(t.value=!1,delete w.value?.edit,delete w.value?.create,M(w.value?.data_permission),a.dispatch("role/createRole",{curRole:w.value})):a.commit("POP_MESSAGE",{message:"角色名不能为空",type:"error"})},b=async({row:e})=>{e.edit=!0,await a.dispatch("role/getRoleDetails",{id:e.id}).then((a=>{1e4==a.data.code&&(e=a.data.data)})).catch((e=>{console.log("err",e)}))},y=({row:e})=>{delete e.edit,M(e.data_permission),a.dispatch("role/updateRole",e)},h=({row:e})=>{d.T.confirm("确定删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.dispatch("role/deleteRole",{id:e.id})})).catch((e=>{console.log(e)}))},v=({row:e})=>{f()},W=(0,l.Fl)((()=>a.state.rightsManagement.curWorkspace?.permission_list||[])),C=(0,l.Fl)((()=>a.state.rightsManagement.curWorkspace?.role_type)),S=e=>[0,1,2].includes(e),U=(e,a)=>{const t=["create","update","read","delete"];a&&t.forEach((a=>{e.includes(a)||e.push(a)}))},j=(e,a)=>{a||(e.length=0)},x=(e,a)=>{e[a]=["create","update","delete","read"]},M=e=>{for(const[a,t]of Object.entries(e))t&&t.length||delete e[a]},z=()=>{s.ZP.go(-1)},O=e=>{a.commit("role/SET_PAGE_INFO",{currentPage:e}),f()};return(e,n)=>{const d=(0,l.up)("el-button"),s=(0,l.up)("el-input"),m=(0,l.up)("el-table-column"),f=(0,l.up)("el-checkbox"),M=(0,l.up)("el-checkbox-group"),P=(0,l.up)("Plus"),R=(0,l.up)("el-icon"),V=(0,l.up)("el-tooltip"),q=(0,l.up)("SvgIcon"),E=(0,l.up)("el-table"),F=(0,l.Q2)("permission");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",u,[(0,l.Wm)(d,{onClick:z},{default:(0,l.w5)((()=>[(0,l.Uk)("返回")])),_:1}),(0,l.wy)(((0,l.wg)(),(0,l.j4)(d,{type:"primary",onClick:_,disabled:t.value&&!((0,o.SU)(C)<=1)},{default:(0,l.w5)((()=>[(0,l.Uk)("添加角色")])),_:1},8,["disabled"])),[[F,"create"]])]),(0,l.Wm)(E,{data:(0,o.SU)(k),style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{label:"自定义角色",prop:"name",fixed:""},{default:(0,l.w5)((e=>[e.row?.create?((0,l.wg)(),(0,l.j4)(s,{key:0,modelValue:w.value.name,"onUpdate:modelValue":n[0]||(n[0]=e=>w.value.name=e)},null,8,["modelValue"])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(m,{label:"模块权限",prop:"data_permission"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,o.SU)(W),((e,a)=>((0,l.wg)(),(0,l.j4)(m,{key:a,prop:a,label:(0,o.SU)(i.bm)(a)?.name},{default:(0,l.w5)((e=>[e.row.data_permission&&e.row.data_permission[a]&&e.row.data_permission[a].length?((0,l.wg)(),(0,l.j4)(M,{key:0,modelValue:e.row.data_permission[a],"onUpdate:modelValue":t=>e.row.data_permission[a]=t,disabled:!e.row?.edit},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{label:"create",onChange:t=>U(e.row.data_permission[a],t)},{default:(0,l.w5)((()=>[(0,l.Uk)(" 创建 ")])),_:2},1032,["onChange"]),(0,l.Wm)(f,{label:"update"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 更新 ")])),_:1}),(0,l.Wm)(f,{label:"read",onChange:t=>j(e.row.data_permission[a],t)},{default:(0,l.w5)((()=>[(0,l.Uk)(" 查看 ")])),_:2},1032,["onChange"]),(0,l.Wm)(f,{label:"delete",style:{"margin-right":"30px"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" 删除 ")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):e.row.edit?((0,l.wg)(),(0,l.j4)(V,{key:1,effect:"dark",content:"添加",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(R,{onClick:t=>x(e.row.data_permission,a),style:{"font-size":"18px",color:"var(--el-color-primary)"}},{default:(0,l.w5)((()=>[(0,l.Wm)(P)])),_:2},1032,["onClick"])])),_:2},1024)):(0,l.kq)("",!0)])),_:2},1032,["prop","label"])))),128))])),_:1}),(0,l.Wm)(m,{label:"更新时间",prop:"updated_at",formatter:(0,o.SU)(i.lI)},null,8,["formatter"]),(0,l.Wm)(m,{label:"操作",fixed:"right"},{default:(0,l.w5)((e=>[(0,o.SU)(C)<=e.row.role_type?((0,l.wg)(),(0,l.iD)("div",p,[e.row.create?((0,l.wg)(),(0,l.j4)(V,{key:0,effect:"dark",content:"创建",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{size:"small",circle:"",onClick:(0,r.iM)(g,["stop"]),class:"icon-button"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"done",stroke:"var(--el-color-primary)"})])),_:1},8,["onClick"])])),_:1})):e.row.edit?((0,l.wg)(),(0,l.j4)(V,{key:1,effect:"dark",content:"更新",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{size:"small",circle:"",onClick:(0,r.iM)((a=>y(e)),["stop"]),class:"icon-button"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"refresh",stroke:"var(--el-color-primary)"})])),_:2},1032,["onClick"])])),_:2},1024)):((0,l.wg)(),(0,l.j4)(V,{key:2,effect:"dark",content:"编辑",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{size:"small",circle:"",onClick:(0,r.iM)((a=>b(e)),["stop"]),disabled:S(e.row.role_type),class:"icon-button"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"edit",stroke:"var(--el-color-primary)"})])),_:2},1032,["onClick","disabled"])])),_:2},1024)),e.row.create||e.row.edit?((0,l.wg)(),(0,l.j4)(V,{key:3,effect:"dark",content:"取消",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{size:"small",circle:"",onClick:(0,r.iM)((a=>v(e)),["stop"]),class:"icon-button"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"close",stroke:"var(--el-color-primary)"})])),_:2},1032,["onClick"])])),_:2},1024)):(0,l.kq)("",!0),e.row.create?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(V,{key:4,effect:"dark",content:"删除",placement:"top"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{size:"small",circle:"",onClick:(0,r.iM)((a=>h(e)),["stop"]),disabled:S(e.row.role_type),class:"icon-button"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{name:"delete",stroke:"#f56c6c"})])),_:2},1032,["onClick","disabled"])])),_:2},1024))])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data"]),(0,l.Wm)(c.Z,{module:(0,o.SU)(a).state.role.pageInfo,onChangePage:O},null,8,["module"])])}}}),w=t(3744);const f=(0,w.Z)(m,[["__scopeId","data-v-5784d446"]]);var k=f}}]);
//# sourceMappingURL=774.9df627b7.js.map