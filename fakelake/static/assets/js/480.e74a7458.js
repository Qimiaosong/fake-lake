"use strict";(self["webpackChunkdata_lake_analytics"]=self["webpackChunkdata_lake_analytics"]||[]).push([[480],{8480:function(e,a,l){l.r(a),l.d(a,{default:function(){return b}});l(7658);var o=l(6252),t=l(2262),n=l(9963),r=l(3907),u=l(2201),s=l(9737),c=l(3625),p=l(219),m=l(6583);const d=(0,o._)("p",{class:"component-heading"},"数据源管理",-1),i={class:"btn-box"},_={key:0},v={key:1},w={key:2},f={key:3};var g=(0,o.aZ)({__name:"DataSourceView",setup(e){const a=(0,r.oR)(),l=(0,u.tv)(),g=(0,t.iH)(),y=(0,t.iH)(!1),b=(0,t.iH)(!0),V=(0,t.iH)(""),W=(0,t.iH)([{name:"MySQL",value:0}]),h=(0,t.qj)({name:[{validator:m.ym,trigger:"blur",required:!0}],type:[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.host":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.port":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.databse_name":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.user":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.password":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.odps_url":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.access_key_id":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.access_key_secret":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.project_name":[{required:!0,trigger:"blur",message:"不能为空"}],"connection_params.extra_params":[{validator:m.BH,trigger:"blur"}]}),k={0:{host:"",port:"",user:"",password:"",databse_name:"",extra_params:""},1:{host:"",port:"",databse_name:"",extra_params:""},2:{odps_url:"",tunnel_url:"",access_key_id:"",access_key_secret:"",project_name:"",extra_params:""},3:{host:"",port:"",user:"",password:"",databse_name:"",extra_params:""},4:{host:"",port:"",user:"",password:"",databse_name:"",extra_params:"",fenodes:[""]},5:{host:"",port:"",user:"",password:"",databse_name:"",extra_params:""}},S={name:"",type:0,connection_params:JSON.parse(JSON.stringify(k[0])),description:"",owner_id:1,extra_params:""},U=(0,t.iH)(JSON.parse(JSON.stringify(S))),x=(0,o.Fl)((()=>a.state.dataSource.dataSourceList)),D=()=>{a.dispatch("dataSource/getDataSourceList",{searchContent:V.value})};(0,o.wF)((()=>{D()}));const C=e=>{y.value=e},q=()=>{C(!1)},j=()=>{U.value=JSON.parse(JSON.stringify(S)),C(!0),b.value=!0},N=async()=>{let e=[g.value];(0,m.R2)(e).then((async e=>{try{const e=await a.dispatch("dataSource/createDataSource",{curDataSource:U.value});if(10034===e?.data?.code)C(!1),s.T.confirm("您可创建的数据源数量已达到上线，如果需要更多资源，请点击 去升级 前往关于页获取License!","提示",{confirmButtonText:"去升级",cancelButtonText:"暂时不用",type:"warning"}).then((()=>{l.push("/home/about")})).catch((()=>{}));else{if(10002===e?.data?.code)return;C(!1)}}catch(o){console.error(o)}}))},O=({row:e})=>{C(!0),b.value=!1,F(),a.dispatch("dataSource/getDataSourceDetails",e).then((e=>{1e4==e.data.code?(U.value=e.data.data,U.value.connection_params.extra_params=JSON.stringify((0,m.iz)(e.data.data.connection_params.extra_params),null,2)||""):U.value=JSON.parse(JSON.stringify(S))})).catch((e=>{console.log("err",e)}))},J=async()=>{let e=[g.value];(0,m.R2)(e).then((e=>{a.dispatch("dataSource/updateDataSource",{curDataSource:U.value}).then((()=>{C(!1)}))})).catch((e=>{console.log(e)}))},H=({row:e,$index:l})=>{a.dispatch("dataSource/deleteDataSource",{id:e.id})},F=()=>{a.dispatch("dataSource/getDataSourceType").then((e=>{1e4===e.data?.code?W.value=e.data.data:W.value=[{name:"MySQL",value:0}]})).catch((e=>{console.log("err",e)}))},I=e=>{e&&F()},T=e=>{U.value.connection_params=k[e]?JSON.parse(JSON.stringify(k[e])):JSON.parse(JSON.stringify(k[0]))},L=()=>{U.value.connection_params?.fenodes.push("")},M=e=>{U.value.connection_params?.fenodes.splice(e,1)},E=e=>{if(e>0)return!0},R=e=>{a.commit("dataSource/SET_PAGE_INFO",{currentPage:e}),D()},z=(0,m.Ds)((()=>{R(1)}),500),B=()=>{z()};return(e,l)=>{const r=(0,o.up)("el-button"),u=(0,o.up)("el-input"),s=(0,o.up)("el-table-column"),k=(0,o.up)("SvgIcon"),S=(0,o.up)("el-tooltip"),D=(0,o.up)("el-table"),F=(0,o.up)("el-form-item"),z=(0,o.up)("el-option"),K=(0,o.up)("el-select"),P=(0,o.up)("Delete"),Q=(0,o.up)("el-icon"),Z=(0,o.up)("el-form"),Y=(0,o.Q2)("permission");return(0,o.wg)(),(0,o.iD)("div",null,[d,(0,o._)("div",i,[(0,o.wy)(((0,o.wg)(),(0,o.j4)(r,{class:"create-btn",type:"primary",onClick:j},{default:(0,o.w5)((()=>[(0,o.Uk)("创建数据源")])),_:1})),[[Y,"create"]]),(0,o.Wm)(u,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value=e),onInput:B,placeholder:"根据名称查询"},null,8,["modelValue"])]),(0,o.Wm)(D,{data:(0,t.SU)(x),style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{prop:"name",label:"名称"}),(0,o.Wm)(s,{prop:"type",label:"类型",formatter:(0,t.SU)(m.rv)},null,8,["formatter"]),(0,o.Wm)(s,{prop:"updated_at",label:"更新日期",formatter:(0,t.SU)(m.lI)},null,8,["formatter"]),(0,o.Wm)(s,{prop:"operation",label:"操作"},{default:(0,o.w5)((e=>[(0,o.Wm)(S,{effect:"dark",content:"编辑",placement:"top",offset:2,"popper-class":"el-popper-low"},{default:(0,o.w5)((()=>[(0,o.wy)(((0,o.wg)(),(0,o.j4)(r,{size:"small",circle:"",onClick:(0,n.iM)((a=>O(e)),["stop"]),class:"icon-button"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{name:"edit",stroke:"var(--el-color-primary)"})])),_:2},1032,["onClick"])),[[Y,"update"]])])),_:2},1024),(0,o.Wm)(S,{effect:"dark",content:"删除",placement:"top",offset:2,"popper-class":"el-popper-low"},{default:(0,o.w5)((()=>[(0,o.wy)(((0,o.wg)(),(0,o.j4)(r,{size:"small",circle:"",onClick:(0,n.iM)((a=>(0,t.SU)(m.qK)(e,H)),["stop"]),class:"icon-button"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{name:"delete",stroke:"#f56c6c"})])),_:2},1032,["onClick"])),[[Y,"delete"]])])),_:2},1024)])),_:1})])),_:1},8,["data"]),(0,o.Wm)(c.Z,{show:y.value,onHandleShow:l[18]||(l[18]=e=>C(!1))},{popup:(0,o.w5)((()=>[(0,o.Wm)(Z,{"label-width":"150px",model:U.value,ref_key:"ruleFormRef",ref:g,rules:h},{default:(0,o.w5)((()=>[(0,o.Wm)(F,{label:"名称",prop:"name"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value.name=e),disabled:!b.value},null,8,["modelValue","disabled"])])),_:1}),(0,o.Wm)(F,{label:"类型",prop:"type"},{default:(0,o.w5)((()=>[(0,o.Wm)(K,{modelValue:U.value.type,"onUpdate:modelValue":l[2]||(l[2]=e=>U.value.type=e),"value-key":"value",onVisibleChange:I,onChange:T,placeholder:"请选择","no-data-text":"没有数据"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(W.value,((e,a)=>((0,o.wg)(),(0,o.j4)(z,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),[0,3,4,5].includes(U.value.type)?((0,o.wg)(),(0,o.iD)("div",_,[(0,o.Wm)(F,{label:"地址",prop:"connection_params.host"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.host,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value.connection_params.host=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"端口",prop:"connection_params.port"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.port,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value.connection_params.port=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"数据库名",prop:"connection_params.databse_name"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.databse_name,"onUpdate:modelValue":l[5]||(l[5]=e=>U.value.connection_params.databse_name=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"数据库用户名",prop:"connection_params.user"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.user,"onUpdate:modelValue":l[6]||(l[6]=e=>U.value.connection_params.user=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"数据库密码",prop:"connection_params.password"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.password,"onUpdate:modelValue":l[7]||(l[7]=e=>U.value.connection_params.password=e),"show-password":""},null,8,["modelValue"])])),_:1})])):(0,o.kq)("",!0),4===U.value.type?((0,o.wg)(),(0,o.iD)("div",v,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(U.value.connection_params.fenodes,((e,a)=>((0,o.wg)(),(0,o.j4)(F,{label:0===a?"FE http地址":"",prop:`connection_params.fenodes.${a}`},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.j4)(u,{key:a,modelValue:U.value.connection_params.fenodes[a],"onUpdate:modelValue":e=>U.value.connection_params.fenodes[a]=e},null,8,["modelValue","onUpdate:modelValue"])),(0,o.wy)((0,o.Wm)(Q,{onClick:e=>M(a),color:"#f56c6c",style:{"margin-left":"5px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(P)])),_:2},1032,["onClick"]),[[n.F8,E(a)]])])),_:2},1032,["label","prop"])))),256)),(0,o.Wm)(F,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{type:"text",onClick:L},{default:(0,o.w5)((()=>[(0,o.Uk)("+ 添加FE http地址")])),_:1})])),_:1})])):1===U.value.type?((0,o.wg)(),(0,o.iD)("div",w,[(0,o.Wm)(F,{label:"地址",prop:"connection_params.host"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.host,"onUpdate:modelValue":l[8]||(l[8]=e=>U.value.connection_params.host=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"端口",prop:"connection_params.port"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.port,"onUpdate:modelValue":l[9]||(l[9]=e=>U.value.connection_params.port=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"topic名",prop:"connection_params.databse_name"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.databse_name,"onUpdate:modelValue":l[10]||(l[10]=e=>U.value.connection_params.databse_name=e)},null,8,["modelValue"])])),_:1})])):2===U.value.type?((0,o.wg)(),(0,o.iD)("div",f,[(0,o.Wm)(F,{label:"MaxCompute地址",prop:"connection_params.odps_url"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.odps_url,"onUpdate:modelValue":l[11]||(l[11]=e=>U.value.connection_params.odps_url=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"Tunnel地址",prop:"connection_params.tunnel_url"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.tunnel_url,"onUpdate:modelValue":l[12]||(l[12]=e=>U.value.connection_params.tunnel_url=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"账号ID",prop:"connection_params.access_key_id"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.access_key_id,"onUpdate:modelValue":l[13]||(l[13]=e=>U.value.connection_params.access_key_id=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"账号密码",prop:"connection_params.access_key_secret"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.access_key_secret,"onUpdate:modelValue":l[14]||(l[14]=e=>U.value.connection_params.access_key_secret=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,{label:"项目名称",prop:"connection_params.project_name"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.project_name,"onUpdate:modelValue":l[15]||(l[15]=e=>U.value.connection_params.project_name=e)},null,8,["modelValue"])])),_:1})])):(0,o.kq)("",!0),[void 0,null].includes(U.value.connection_params?.extra_params)?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(F,{key:4,label:"扩展配置",prop:"connection_params.extra_params"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.connection_params.extra_params,"onUpdate:modelValue":l[16]||(l[16]=e=>U.value.connection_params.extra_params=e),type:"textarea"},null,8,["modelValue"])])),_:1})),(0,o.Wm)(F,{label:"描述",prop:"description"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:U.value.description,"onUpdate:modelValue":l[17]||(l[17]=e=>U.value.description=e),type:"textarea"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(F,null,{default:(0,o.w5)((()=>[b.value?((0,o.wg)(),(0,o.j4)(r,{key:0,type:"primary",onClick:N},{default:(0,o.w5)((()=>[(0,o.Uk)("创建")])),_:1})):((0,o.wg)(),(0,o.j4)(r,{key:1,type:"primary",onClick:J},{default:(0,o.w5)((()=>[(0,o.Uk)("更新")])),_:1})),(0,o.Wm)(r,{onClick:q},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["show"]),(0,o.Wm)(p.Z,{module:(0,t.SU)(a).state.dataSource.pageInfo,onChangePage:R},null,8,["module"])])}}});const y=g;var b=y}}]);
//# sourceMappingURL=480.e74a7458.js.map